<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Velocidade de Internet - Tecnico Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tech-blue': '#1e40af',
                        'tech-purple': '#7c3aed',
                        'tech-cyan': '#0891b2',
                        'tech-green': '#059669',
                        'tech-orange': '#ea580c',
                        'tech-pink': '#db2777'
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 3s infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            to { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8); }
        }
        
        .gauge {
            position: relative;
            border-radius: 50%/100% 100% 0 0;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .gauge-fill {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: center top;
            transform: rotate(0.0001deg);
            transition: transform 1s ease-out;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .gauge-center {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 20px;
            height: 20px;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffffff, #f3f4f6);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .gauge-value {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: #1f2937;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .gauge-label {
            position: absolute;
            bottom: -30px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 1rem;
            color: #6b7280;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-tech-blue via-tech-purple to-tech-cyan shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 backdrop-blur-sm rounded-full p-3 animate-glow">
                        <i class="fas fa-tachometer-alt text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">Teste de Velocidade</h1>
                        <p class="text-blue-100">Meça a velocidade da sua conexão</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-2 text-white/80">
                    <i class="fas fa-wifi text-lg animate-pulse"></i>
                    <span class="text-sm">Tecnico Online</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Painel de Navegação -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-4">
                <i class="fas fa-compass text-tech-blue text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Navegação</h2>
            </div>
            <div class="flex flex-wrap gap-3">
                <a href="index.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-tech-blue to-tech-purple text-white rounded-xl hover:from-tech-purple hover:to-tech-cyan transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-home mr-2 group-hover:animate-bounce"></i>
                    Início
                </a>
                <a href="teste-seu-teclado.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-tech-green hover:to-tech-cyan transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-keyboard mr-2 group-hover:animate-bounce"></i>
                    Teclado
                </a>
                <a href="teste-seu-processador.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-tech-orange hover:to-tech-pink transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-microchip mr-2 group-hover:animate-bounce"></i>
                    Processador
                </a>
                <a href="audio-microfone.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-tech-purple hover:to-tech-pink transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-microphone mr-2 group-hover:animate-bounce"></i>
                    Áudio
                </a>
                <a href="teste-touch-screen.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-tech-cyan hover:to-tech-green transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-hand-pointer mr-2 group-hover:animate-bounce"></i>
                    Touch
                </a>
                <a href="teste-velocidade-internet.html" class="group flex items-center px-4 py-2 bg-gradient-to-r from-tech-blue to-tech-purple text-white rounded-xl shadow-lg ring-2 ring-white/30">
                    <i class="fas fa-tachometer-alt mr-2 animate-pulse"></i>
                    Velocidade
                </a>
            </div>
        </div>
        
        <!-- Informações de Conexão -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-6">
                <i class="fas fa-info-circle text-tech-cyan text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Informações de Conexão</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="flex items-center p-3 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl">
                        <i class="fas fa-network-wired text-tech-blue mr-3"></i>
                        <div>
                            <span class="font-medium text-gray-700">Tipo de Conexão:</span>
                            <span id="connection-type" class="ml-2 text-tech-blue font-semibold">Detectando...</span>
                        </div>
                    </div>
                    <div class="flex items-center p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                        <i class="fas fa-building text-tech-purple mr-3"></i>
                        <div>
                            <span class="font-medium text-gray-700">Provedor:</span>
                            <span id="isp-info" class="ml-2 text-tech-purple font-semibold">Detectando...</span>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
                        <i class="fas fa-globe text-tech-green mr-3"></i>
                        <div>
                            <span class="font-medium text-gray-700">Endereço IP:</span>
                            <span id="ip-address" class="ml-2 text-tech-green font-semibold">Detectando...</span>
                        </div>
                    </div>
                    <div class="flex items-center p-3 bg-gradient-to-r from-orange-50 to-red-50 rounded-xl">
                        <i class="fas fa-map-marker-alt text-tech-orange mr-3"></i>
                        <div>
                            <span class="font-medium text-gray-700">Localização:</span>
                            <span id="location-info" class="ml-2 text-tech-orange font-semibold">Detectando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Painel de Controle -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-6">
                <i class="fas fa-play-circle text-tech-blue text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Controles de Teste</h2>
            </div>
            <div class="flex flex-wrap gap-4 justify-center">
                <button id="start-test" class="group px-6 py-3 bg-gradient-to-r from-tech-blue to-tech-purple text-white rounded-xl hover:from-tech-purple hover:to-tech-cyan transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center">
                    <i class="fas fa-play mr-2 group-hover:animate-pulse"></i>
                    Iniciar Teste Completo
                </button>
                <button id="test-download" class="group px-6 py-3 bg-gradient-to-r from-tech-green to-emerald-600 text-white rounded-xl hover:from-emerald-600 hover:to-tech-cyan transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center">
                    <i class="fas fa-download mr-2 group-hover:animate-bounce"></i>
                    Testar Download
                </button>             
            </div>
        </div>
        
        <!-- Medidores -->
        <div class="grid grid-cols-1 md:grid-cols-1 gap-6 mb-8">
            <!-- Medidor de Download -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover border border-white/20">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-download text-tech-green text-xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Download</h3>
                </div>
                <div class="flex justify-center mb-8">
                    <div class="gauge h-32 w-64 animate-float">
                        <div id="download-gauge-fill" class="gauge-fill"></div>
                        <div class="gauge-center"></div>
                        <div id="download-value" class="gauge-value">0</div>
                        <div class="gauge-label">Mbps</div>
                    </div>
                </div>
                <div class="text-center">
                    <div id="download-progress" class="h-3 w-full bg-gray-200 rounded-full overflow-hidden mb-3 shadow-inner">
                        <div class="h-full bg-gradient-to-r from-tech-green to-emerald-400 w-0 transition-all duration-300 rounded-full"></div>
                    </div>
                    <p id="download-status" class="text-sm text-gray-600 font-medium">Aguardando teste...</p>
                </div>
            </div>
            
         
        </div>
        
        <!-- Resultados -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-6">
                <i class="fas fa-chart-line text-tech-blue text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Resultados Detalhados</h2>
            </div>
            <div class="overflow-x-auto rounded-xl">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr class="bg-gradient-to-r from-gray-50 to-blue-50">
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                <i class="fas fa-calendar-alt mr-2 text-tech-blue"></i>Data/Hora
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                <i class="fas fa-download mr-2 text-tech-green"></i>Download
                            </th>
                            
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                <i class="fas fa-network-wired mr-2 text-tech-pink"></i>Conexão
                            </th>
                        </tr>
                    </thead>
                    <tbody id="results-table" class="bg-white/50 divide-y divide-gray-200">
                        <!-- Resultados serão adicionados aqui -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Gráfico de Histórico -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-6">
                <i class="fas fa-chart-area text-tech-purple text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Histórico de Testes</h2>
            </div>
            <div class="h-64 bg-gradient-to-br from-gray-50 to-blue-50 rounded-xl p-4">
                <canvas id="history-chart"></canvas>
            </div>
        </div>
        
        <!-- Recomendações -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8 card-hover border border-white/20">
            <div class="flex items-center mb-6">
                <i class="fas fa-lightbulb text-tech-orange text-xl mr-3"></i>
                <h2 class="text-xl font-semibold text-gray-800">Recomendações</h2>
            </div>
            <div id="recommendations" class="space-y-3">
                <div class="flex items-center p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl">
                    <i class="fas fa-info-circle text-tech-blue mr-3"></i>
                    <p class="text-gray-600">Complete um teste para receber recomendações personalizadas sobre sua conexão.</p>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover border border-white/20">
            <div class="text-center">
                <div class="flex items-center justify-center mb-4">
                    <div class="bg-gradient-to-r from-tech-blue to-tech-purple rounded-full p-3 mr-3 animate-pulse">
                        <i class="fas fa-code text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Tecnico Online</h3>
                        <p class="text-sm text-gray-600">Ferramentas de teste profissionais</p>
                    </div>
                </div>
                <div class="flex justify-center space-x-6 text-sm text-gray-500">
                    <div class="flex items-center">
                        <i class="fas fa-tachometer-alt mr-2 text-tech-blue"></i>
                        <span>Teste de Velocidade</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt mr-2 text-tech-green"></i>
                        <span>Seguro e Confiável</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-mobile-alt mr-2 text-tech-purple"></i>
                        <span>Responsivo</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Elementos DOM
        const startTestBtn = document.getElementById('start-test');
        const testDownloadBtn = document.getElementById('test-download');
        const downloadValue = document.getElementById('download-value');
        const downloadGaugeFill = document.getElementById('download-gauge-fill');
        const downloadProgress = document.getElementById('download-progress').querySelector('div');
        const downloadStatus = document.getElementById('download-status');
        const resultsTable = document.getElementById('results-table');
        const connectionType = document.getElementById('connection-type');
        const ispInfo = document.getElementById('isp-info');
        const ipAddress = document.getElementById('ip-address');
        const locationInfo = document.getElementById('location-info');
        const recommendations = document.getElementById('recommendations');

        // Variáveis globais
        let testHistory = [];
        let chart = null;
        let testInProgress = false;
        let connectionInfo = {
            type: 'Desconhecido',
            isp: 'Desconhecido',
            ip: 'Desconhecido',
            location: 'Desconhecido'
        };

        // Inicializar gráfico
        function initChart() {
            const ctx = document.getElementById('history-chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Download (Mbps)',
                            data: [],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.1
                        },
                        
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Velocidade (Mbps)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Testes'
                            }
                        }
                    }
                }
            });
        }

        // Função para atualizar o medidor
        function updateGauge(gaugeElement, value, maxValue) {
            // Calcular ângulo (180 graus é o máximo)
            const percentage = Math.min(value / maxValue, 1);
            const angle = percentage * 180;
            gaugeElement.style.transform = `rotate(${angle}deg)`;
            
            // Atualizar cor com base na porcentagem
            if (percentage < 0.3) {
                gaugeElement.style.backgroundColor = '#ef4444'; // Vermelho
            } else if (percentage < 0.7) {
                gaugeElement.style.backgroundColor = '#f59e0b'; // Amarelo
            } else {
                gaugeElement.style.backgroundColor = '#10b981'; // Verde
            }
        }

        // Função para atualizar a barra de progresso
        function updateProgress(progressElement, percentage) {
            progressElement.style.width = `${percentage}%`;
        }

        // Função para detectar informações de conexão
        async function detectConnectionInfo() {
            try {
                // Detectar tipo de conexão
                if (navigator.connection) {
                    connectionInfo.type = navigator.connection.effectiveType || 'Desconhecido';
                    connectionType.textContent = connectionInfo.type.toUpperCase();
                }
                
                // Obter informações de IP e localização
                const response = await fetch('https://ipinfo.io/json');
                const data = await response.json();
                
                connectionInfo.ip = data.ip || 'Desconhecido';
                connectionInfo.isp = data.org || 'Desconhecido';
                connectionInfo.location = data.city && data.country ? `${data.city}, ${data.country}` : 'Desconhecido';
                
                ipAddress.textContent = connectionInfo.ip;
                ispInfo.textContent = connectionInfo.isp.replace(/^AS\d+\s/, ''); // Remover prefixo AS
                locationInfo.textContent = connectionInfo.location;
            } catch (error) {
                console.error('Erro ao obter informações de conexão:', error);
                connectionType.textContent = 'Erro ao detectar';
                ipAddress.textContent = 'Erro ao detectar';
                ispInfo.textContent = 'Erro ao detectar';
                locationInfo.textContent = 'Erro ao detectar';
            }
        }

        

        // Função para testar velocidade de download
        async function testDownload() {
            if (testInProgress) return;
            testInProgress = true;
            
            downloadStatus.textContent = 'Iniciando teste de download...';
            updateProgress(downloadProgress, 10);
            
            try {
                // Tamanho do arquivo de teste (em bytes)
                const testSizes = [1000000, 2000000, 5000000, 10000000]; // 1MB, 2MB, 5MB, 10MB
                let totalSpeed = 0;
                let testCount = 0;
                
                for (let i = 0; i < testSizes.length; i++) {
                    const fileSize = testSizes[i];
                    
                    downloadStatus.textContent = `Baixando arquivo de teste ${i+1}/${testSizes.length}...`;
                    updateProgress(downloadProgress, 10 + (i * 20));
                    
                    // Usar um timestamp para evitar cache
                    const url = `https://speed.cloudflare.com/__down?bytes=${fileSize}&t=${Date.now()}`;
                    const startTime = performance.now();
                    
                    try {
                        const response = await fetch(url);
                        const data = await response.blob();
                        const endTime = performance.now();
                        
                        // Calcular velocidade em Mbps
                        const durationSeconds = (endTime - startTime) / 1000;
                        const fileSizeMb = fileSize / 1000000 * 8; // Converter para megabits
                        const speedMbps = fileSizeMb / durationSeconds;
                        
                        totalSpeed += speedMbps;
                        testCount++;
                        
                        // Atualizar UI durante o teste
                        const currentSpeed = Math.round(speedMbps * 10) / 10;
                        downloadValue.textContent = currentSpeed;
                        updateGauge(downloadGaugeFill, currentSpeed, 100); // 100 Mbps como valor máximo
                    } catch (error) {
                        console.error(`Erro no teste ${i+1}:`, error);
                    }
                    
                    // Pequena pausa entre testes
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
                
                // Calcular média final
                const avgSpeed = testCount > 0 ? Math.round((totalSpeed / testCount) * 10) / 10 : 0;
                
                // Atualizar UI final
                downloadValue.textContent = avgSpeed;
                updateGauge(downloadGaugeFill, avgSpeed, 100);
                updateProgress(downloadProgress, 100);
                downloadStatus.textContent = `Velocidade média: ${avgSpeed} Mbps`;
                
                return avgSpeed;
            } catch (error) {
                console.error('Erro ao testar download:', error);
                downloadStatus.textContent = 'Erro ao testar download';
                updateProgress(downloadProgress, 0);
                return null;
            } finally {
                testInProgress = false;
            }
        }

        

        // Função para executar teste completo
        async function runFullTest() {
            if (testInProgress) return;
            
            // Resetar UI
            startTestBtn.disabled = true;
            testDownloadBtn.disabled = true;
            
            startTestBtn.textContent = 'Teste em andamento...';
            
            // Executar apenas download
            const downloadResult = await testDownload();
            
            // Registrar resultados
            if (downloadResult !== null) {
                const testResult = {
                    timestamp: new Date(),
                    download: downloadResult,
                    connection: connectionInfo.type
                };
                
                testHistory.push(testResult);
                addResultToTable(testResult);
                updateChart();
                generateRecommendations(testResult);
                
                // Salvar no localStorage
                try {
                    localStorage.setItem('speedTestHistory', JSON.stringify(testHistory));
                } catch (e) {
                    console.error('Erro ao salvar histórico:', e);
                }
            }
            
            // Restaurar UI
            startTestBtn.disabled = false;
            testDownloadBtn.disabled = false;
            
            startTestBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                </svg>
                Iniciar Teste Completo
            `;
        }

        // Função para adicionar resultado à tabela
        function addResultToTable(result) {
            const row = document.createElement('tr');
            
            // Formatar data
            const date = new Date(result.timestamp);
            const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${getSpeedClass(result.download)}">${result.download} Mbps</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${result.connection}</td>
            `;
            
            resultsTable.prepend(row);
        }

        // Função para obter classe de cor com base na velocidade
        function getSpeedClass(speed) {
            if (speed < 5) return 'text-red-600';
            if (speed < 15) return 'text-yellow-600';
            return 'text-green-600';
        }

        // Função para obter classe de cor com base no ping
        function getPingClass(ping) {
            if (ping > 100) return 'text-red-600';
            if (ping > 50) return 'text-yellow-600';
            return 'text-green-600';
        }

        // Função para atualizar o gráfico
        function updateChart() {
            if (!chart) return;
            
            const displayHistory = testHistory.slice(-10);
            chart.data.labels = displayHistory.map((_, index) => `Teste ${index + 1}`);
            chart.data.datasets[0].data = displayHistory.map(item => item.download);
            chart.update();
        }

        // Função para gerar recomendações
        function generateRecommendations(result) {
            let recommendationHTML = '';
            
            // Avaliar velocidade de download
            if (result.download < 5) {
                recommendationHTML += `
                    <div class="p-3 bg-red-50 border border-red-200 rounded-md">
                        <h3 class="font-medium text-red-800">Velocidade de download muito baixa</h3>
                        <p class="text-red-700">Sua velocidade de download de ${result.download} Mbps é insuficiente para streaming de vídeo HD e downloads de arquivos grandes.</p>
                        <ul class="list-disc list-inside text-sm text-red-700 mt-2">
                            <li>Verifique se outros dispositivos estão usando sua conexão</li>
                            <li>Reinicie seu roteador</li>
                            <li>Considere atualizar seu plano de internet</li>
                        </ul>
                    </div>
                `;
            } else if (result.download < 15) {
                recommendationHTML += `
                    <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                        <h3 class="font-medium text-yellow-800">Velocidade de download moderada</h3>
                        <p class="text-yellow-700">Sua velocidade de download de ${result.download} Mbps é adequada para navegação básica e streaming em qualidade padrão, mas pode ser insuficiente para múltiplos dispositivos.</p>
                    </div>
                `;
            } else {
                recommendationHTML += `
                    <div class="p-3 bg-green-50 border border-green-200 rounded-md">
                        <h3 class="font-medium text-green-800">Boa velocidade de download</h3>
                        <p class="text-green-700">Sua velocidade de download de ${result.download} Mbps é adequada para a maioria das atividades online, incluindo streaming em HD.</p>
                    </div>
                `;
            }
            
            
            
            recommendations.innerHTML = recommendationHTML;
        }

        // Carregar histórico do localStorage
        function loadHistory() {
            try {
                const savedHistory = localStorage.getItem('speedTestHistory');
                if (savedHistory) {
                    testHistory = JSON.parse(savedHistory);
                    
                    // Converter strings de data para objetos Date
                    testHistory.forEach(item => {
                        if (typeof item.timestamp === 'string') {
                            item.timestamp = new Date(item.timestamp);
                        }
                    });
                    
                    // Adicionar à tabela
                    testHistory.forEach(result => addResultToTable(result));
                    
                    // Atualizar gráfico
                    updateChart();
                }
            } catch (e) {
                console.error('Erro ao carregar histórico:', e);
            }
        }

        // Event Listeners
        startTestBtn.addEventListener('click', runFullTest);
        testDownloadBtn.addEventListener('click', testDownload);

        // Inicialização
        window.addEventListener('load', () => {
            detectConnectionInfo();
            initChart();
            loadHistory();
        });
    </script>
</body>
</html>